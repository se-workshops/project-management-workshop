# 基本設計書

## 1. システム構成

### 1.1 全体アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                      クライアント（ブラウザ）                  │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              React SPA アプリケーション                │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐            │   │
│  │  │  Pages   │ │Components│ │  Hooks   │            │   │
│  │  └──────────┘ └──────────┘ └──────────┘            │   │
│  │  ┌──────────────────────────────────────┐          │   │
│  │  │         State Management             │          │   │
│  │  │      (React Context / useState)      │          │   │
│  │  └──────────────────────────────────────┘          │   │
│  └─────────────────────────────────────────────────────┘   │
│                            │                                │
│                     HTTP REST API                           │
│                            │                                │
└────────────────────────────┼────────────────────────────────┘
                             │
┌────────────────────────────┼────────────────────────────────┐
│                      サーバーサイド                          │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Express.js サーバー                      │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐            │   │
│  │  │  Routes  │ │Controllers│ │ Services │            │   │
│  │  └──────────┘ └──────────┘ └──────────┘            │   │
│  │  ┌──────────────────────────────────────┐          │   │
│  │  │       In-Memory Data Store           │          │   │
│  │  │    (ダミーデータ / ランタイムデータ)    │          │   │
│  │  └──────────────────────────────────────┘          │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 技術スタック

| レイヤー | 技術 | バージョン |
|---------|------|-----------|
| フロントエンド | React | 18.x |
| ルーティング | React Router | 6.x |
| スタイリング | CSS Modules / Tailwind CSS | - |
| HTTP通信 | Fetch API / Axios | - |
| バックエンド | Node.js + Express.js | 20.x / 4.x |
| ビルドツール | Vite | 5.x |

---

## 2. フロントエンド設計

### 2.1 ディレクトリ構成

```
src/
├── components/          # 再利用可能なUIコンポーネント
│   ├── common/          # 汎用コンポーネント
│   │   ├── Button.jsx
│   │   ├── Input.jsx
│   │   ├── Modal.jsx
│   │   └── Loading.jsx
│   ├── layout/          # レイアウトコンポーネント
│   │   ├── Header.jsx
│   │   ├── Footer.jsx
│   │   └── Sidebar.jsx
│   ├── product/         # 商品関連コンポーネント
│   │   ├── ProductCard.jsx
│   │   ├── ProductList.jsx
│   │   └── ProductFilter.jsx
│   └── cart/            # カート関連コンポーネント
│       ├── CartItem.jsx
│       └── CartSummary.jsx
├── pages/               # ページコンポーネント
│   ├── LoginPage.jsx
│   ├── ProductListPage.jsx
│   ├── ProductDetailPage.jsx
│   ├── CartPage.jsx
│   ├── CheckoutPage.jsx
│   ├── OrderCompletePage.jsx
│   └── OrderHistoryPage.jsx
├── hooks/               # カスタムフック
│   ├── useAuth.js
│   ├── useCart.js
│   └── useProducts.js
├── context/             # Contextプロバイダー
│   ├── AuthContext.jsx
│   └── CartContext.jsx
├── services/            # API通信サービス
│   ├── api.js
│   ├── authService.js
│   ├── productService.js
│   └── orderService.js
├── utils/               # ユーティリティ関数
│   └── formatters.js
├── App.jsx
├── main.jsx
└── index.css
```

### 2.2 画面遷移図

```
                    ┌─────────────┐
                    │  ログイン画面  │
                    │  (SCR-001)  │
                    └──────┬──────┘
                           │ ログイン成功
                           ▼
                    ┌─────────────┐
            ┌───────│ 商品一覧画面  │───────┐
            │       │  (SCR-002)  │       │
            │       └──────┬──────┘       │
            │              │              │
            │     商品クリック│              │ カートアイコン
            │              ▼              │
            │       ┌─────────────┐       │
            │       │ 商品詳細画面  │       │
            │       │  (SCR-003)  │       │
            │       └──────┬──────┘       │
            │              │              │
            │   カートに追加 │              │
            │              ▼              ▼
            │       ┌─────────────────────┐
            └──────►│     カート画面       │
                    │     (SCR-004)       │
                    └──────────┬──────────┘
                               │ 注文へ進む
                               ▼
                    ┌─────────────────────┐
                    │    注文確認画面      │
                    │     (SCR-005)       │
                    └──────────┬──────────┘
                               │ 注文確定
                               ▼
                    ┌─────────────────────┐
                    │    注文完了画面      │
                    │     (SCR-006)       │
                    └─────────────────────┘

    ※ ヘッダーから注文履歴画面 (SCR-007) へ遷移可能
```

### 2.3 状態管理設計

```
┌────────────────────────────────────────────────────────┐
│                    App (Root)                          │
│  ┌──────────────────────────────────────────────────┐ │
│  │              AuthContext.Provider                 │ │
│  │  ┌────────────────────────────────────────────┐  │ │
│  │  │          CartContext.Provider              │  │ │
│  │  │  ┌──────────────────────────────────────┐  │  │ │
│  │  │  │           Router / Pages             │  │  │ │
│  │  │  └──────────────────────────────────────┘  │  │ │
│  │  └────────────────────────────────────────────┘  │ │
│  └──────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────┘

AuthContext:
  - user: ログインユーザー情報
  - isAuthenticated: 認証状態
  - login(): ログイン処理
  - logout(): ログアウト処理

CartContext:
  - items: カート内商品リスト
  - totalAmount: 合計金額
  - addItem(): 商品追加
  - removeItem(): 商品削除
  - updateQuantity(): 数量更新
  - clearCart(): カートクリア
```

---

## 3. バックエンド設計

### 3.1 ディレクトリ構成

```
server/
├── index.js             # エントリーポイント
├── routes/              # ルート定義
│   ├── authRoutes.js
│   ├── productRoutes.js
│   ├── cartRoutes.js
│   └── orderRoutes.js
├── controllers/         # コントローラー
│   ├── authController.js
│   ├── productController.js
│   ├── cartController.js
│   └── orderController.js
├── services/            # ビジネスロジック
│   ├── authService.js
│   ├── productService.js
│   ├── cartService.js
│   └── orderService.js
├── data/                # ダミーデータ
│   ├── users.json
│   ├── products.json
│   └── categories.json
├── store/               # インメモリストア
│   └── dataStore.js
└── middleware/          # ミドルウェア
    └── authMiddleware.js
```

### 3.2 API エンドポイント一覧

#### 認証 API

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| POST | /api/auth/login | ログイン |
| POST | /api/auth/logout | ログアウト |
| GET | /api/auth/me | 現在のユーザー情報取得 |

#### 商品 API

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| GET | /api/products | 商品一覧取得 |
| GET | /api/products/:id | 商品詳細取得 |
| GET | /api/categories | カテゴリ一覧取得 |

#### カート API

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| GET | /api/cart | カート内容取得 |
| POST | /api/cart/items | 商品をカートに追加 |
| PUT | /api/cart/items/:productId | カート内商品の数量変更 |
| DELETE | /api/cart/items/:productId | カートから商品削除 |
| DELETE | /api/cart | カートクリア |

#### 注文 API

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| GET | /api/orders | 注文履歴取得 |
| GET | /api/orders/:id | 注文詳細取得 |
| POST | /api/orders | 注文作成 |

---

## 4. データ設計

### 4.1 インメモリデータストア構造

```javascript
DataStore = {
  users: [],           // ユーザーデータ
  products: [],        // 商品データ
  categories: [],      // カテゴリデータ
  carts: {},           // ユーザーごとのカート { userId: CartData }
  orders: []           // 注文データ
}
```

### 4.2 データ初期化フロー

```
アプリケーション起動
        │
        ▼
┌───────────────────┐
│ ダミーデータ読み込み │
│  (JSON ファイル)   │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ DataStore に格納   │
│  (メモリ上)        │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│  サーバー起動完了   │
└───────────────────┘

        ...

アプリケーション終了
        │
        ▼
┌───────────────────┐
│ DataStore 破棄    │
│ (全データフラッシュ) │
└───────────────────┘
```

---

## 5. セキュリティ設計

### 5.1 認証方式

- **セッションベース認証**（簡易実装）
- ログイン時にセッションIDを発行
- セッションはサーバーメモリ上に保持

### 5.2 セキュリティ考慮事項

| 項目 | 対応 |
|------|------|
| CORS | 開発環境のみ許可 |
| 入力バリデーション | 基本的なバリデーション実装 |
| 認証チェック | 要認証APIにミドルウェア適用 |

※ 本アプリはワークショップ・デモ用のため、本番レベルのセキュリティは適用しない

---

## 6. 開発環境

### 6.1 必要なツール

| ツール | 用途 |
|--------|------|
| Node.js 20.x | 実行環境 |
| npm / yarn | パッケージ管理 |
| VS Code | エディタ |

### 6.2 起動方法

```bash
# フロントエンド開発サーバー
npm run dev

# バックエンドサーバー
npm run server

# 同時起動（concurrently使用）
npm run start
```